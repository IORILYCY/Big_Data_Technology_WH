# 关系模型完整性约束

## 一、实体完整性

* 实体完整性要求每个表都有唯一标识符，每一个表中的主键字段不能为空或者重复的值。

## 二、参照完整性

* 参照完整性要求关系中不允许引用不存在的实体。设定相应的更新删除插入规则来更新参考表。

* 例如表sutdent( id，username，password )，表sutdent_info( id，name，age，sex )。其中表sutdent_info参照了表student。id作为外键。那么当student表删除一行时，表student_info对应的id那一列将被删除或者置空（根据设定的规则而定）。同样，表student_info增加一行，其中的id必须等于student表中的id。

## 三、用户自定义完整性

* 用户自定义完整性是针对某一具体关系数据库的约束条件，它反映某一具体应用所涉及的数据必须满足的语义要求。也就是说：某个表你设置这一列为null，not null，default，check等。包括：非空约束、唯一约束、检查约束、主键约束 、外键约束

1. 非空约束（Not Null Constraint）
   有些列不能把它设为空，则需要在字段定义后添加 `not null` 配置非空约束。

2. 唯一约束（Unique Constraint）
   一个唯一约束并不包括只有一个NULL值。直接在字段定义后加入 `unique` 即可定义该唯一约束。
   1) 一个表只能创建一个主键约束，但一个表可以根据需要对不同的列创建若干unique约束
   2) 主键字段不允许为null，unique允许为空
   3) 一般创建主键约束时，系统自动产生簇索引，unique约束自动产非簇索引

3. 检查约束（The Check Clause）
   通过在定义数据库表里，在字段级或者是在表级加入的检查约束，使其满足特定的要求。如下例中规定字段degree_level的值只能是'Bachelors','Masters','Doctorate'中的一个。

4. 主键约束（Primary Key Constraint）
   其实主键约束就是一张表只能建立一个主键约束，其实就是`唯一约束+非空约束`。

5. 外健约束（ Foreign Key Constraint）
   外键主要是确保同一个表或者不同表之间的引用完整性。
   1) 必须引用一个PRIMARY KEY或者UNIQUE约束
   2) 用户必须在应用表上具有REFERENCES权限
   3) 一个表中最多可以有31个外键约束
   4) 在临时表中，不能使用外键约束
   5) 主键和外键的数据类型必须严格匹配

```sql
create table student ( 
    name varchar(15) not null
    ,student_id varchar(15) not null unique
    ,degree_level varchar(15)
    ,primary key( student_id )
    ,check( degree_level in ('Bachelors','Masters','Doctorate') )
); 
```
